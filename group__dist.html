<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>sgsPy: dist</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">sgsPy
   </div>
   <div id="projectbrief">structurally guided sampling</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('group__dist.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">dist <div class="ingroups"><a class="el" href="group__dev.html">Developer Documentation</a> &raquo; <a class="el" href="group__utils.html">utils</a></div></div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-func-members" class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga35e7a4ba699446c10acceaefb14dfe4b" id="r_ga35e7a4ba699446c10acceaefb14dfe4b"><td class="memTemplParams" colspan="2">template&lt;typename T&gt; </td></tr>
<tr class="memitem:ga35e7a4ba699446c10acceaefb14dfe4b template"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga35e7a4ba699446c10acceaefb14dfe4b">sgs::dist::findMinMax</a> (<a class="el" href="structsgs_1_1helper_1_1RasterBandMetaData.html">helper::RasterBandMetaData</a> &amp;band, int width, int yStartBlock, int yEndBlock, T &amp;min, T &amp;max, std::mutex &amp;mutex, std::condition_variable &amp;cv, bool &amp;finished)</td></tr>
<tr class="memitem:ga676f599eaf7356e8cf8faf7aeb69db58" id="r_ga676f599eaf7356e8cf8faf7aeb69db58"><td class="memTemplParams" colspan="2">template&lt;typename T&gt; </td></tr>
<tr class="memitem:ga676f599eaf7356e8cf8faf7aeb69db58 template"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga676f599eaf7356e8cf8faf7aeb69db58">sgs::dist::setBins</a> (T min, T max, int nBins, GDALDataType type, std::vector&lt; double &gt; &amp;dbins, std::vector&lt; T &gt; &amp;tbins)</td></tr>
<tr class="memitem:gad5cb943b118a5d31fed98224cb9c2222" id="r_gad5cb943b118a5d31fed98224cb9c2222"><td class="memTemplParams" colspan="2">template&lt;typename T&gt; </td></tr>
<tr class="memitem:gad5cb943b118a5d31fed98224cb9c2222 template"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gad5cb943b118a5d31fed98224cb9c2222">sgs::dist::populationDistribution</a> (<a class="el" href="structsgs_1_1helper_1_1RasterBandMetaData.html">helper::RasterBandMetaData</a> &amp;band, int width, int yBlockStart, int yBlockEnd, int nBins, std::vector&lt; T &gt; &amp;binVals, std::vector&lt; int64_t &gt; &amp;counts, std::mutex &amp;mutex, std::condition_variable &amp;cv, bool &amp;finished)</td></tr>
<tr class="memitem:ga7e242c353e4cf32897948d663a8b4196" id="r_ga7e242c353e4cf32897948d663a8b4196"><td class="memTemplParams" colspan="2">template&lt;typename T&gt; </td></tr>
<tr class="memitem:ga7e242c353e4cf32897948d663a8b4196 template"><td class="memItemLeft" align="right" valign="top">std::vector&lt; int64_t &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga7e242c353e4cf32897948d663a8b4196">sgs::dist::sampleDistribution</a> (<a class="el" href="structsgs_1_1helper_1_1RasterBandMetaData.html">helper::RasterBandMetaData</a> &amp;band, std::vector&lt; <a class="el" href="structsgs_1_1helper_1_1Index.html">helper::Index</a> &gt; &amp;samples, std::vector&lt; T &gt; binVals, int nBins)</td></tr>
<tr class="memitem:ga10e2a06d71f7b7d4a37dd701b7bb9dae" id="r_ga10e2a06d71f7b7d4a37dd701b7bb9dae"><td class="memTemplParams" colspan="2">template&lt;typename T&gt; </td></tr>
<tr class="memitem:ga10e2a06d71f7b7d4a37dd701b7bb9dae template"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga10e2a06d71f7b7d4a37dd701b7bb9dae">sgs::dist::calculateDist</a> (<a class="el" href="structsgs_1_1helper_1_1RasterBandMetaData.html">helper::RasterBandMetaData</a> &amp;band, std::vector&lt; <a class="el" href="structsgs_1_1helper_1_1Index.html">helper::Index</a> &gt; &amp;sampled, int height, int width, int nBins, std::unordered_map&lt; std::string, std::pair&lt; std::vector&lt; double &gt;, std::vector&lt; int64_t &gt; &gt; &gt; &amp;retval, int nThreads)</td></tr>
<tr class="memitem:ga5b7558f2557df9cb94b6c4bb8a779e29" id="r_ga5b7558f2557df9cb94b6c4bb8a779e29"><td class="memItemLeft" align="right" valign="top">std::unordered_map&lt; std::string, std::pair&lt; std::vector&lt; double &gt;, std::vector&lt; int64_t &gt; &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga5b7558f2557df9cb94b6c4bb8a779e29">sgs::dist::dist</a> (<a class="el" href="classsgs_1_1raster_1_1GDALRasterWrapper.html">raster::GDALRasterWrapper</a> *p_raster, int index, <a class="el" href="classsgs_1_1vector_1_1GDALVectorWrapper.html">vector::GDALVectorWrapper</a> *p_vector, std::string layer, int nBins, int nThreads)</td></tr>
</table>
<a name="details" id="details"></a><h2 id="header-details" class="groupheader">Detailed Description</h2>
<a name="doc-func-members" id="doc-func-members"></a><h2 id="header-doc-func-members" class="groupheader">Function Documentation</h2>
<a id="ga10e2a06d71f7b7d4a37dd701b7bb9dae" name="ga10e2a06d71f7b7d4a37dd701b7bb9dae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga10e2a06d71f7b7d4a37dd701b7bb9dae">&#9670;&#160;</a></span>calculateDist()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void sgs::dist::calculateDist </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structsgs_1_1helper_1_1RasterBandMetaData.html">helper::RasterBandMetaData</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>band</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="structsgs_1_1helper_1_1Index.html">helper::Index</a> &gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>sampled</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>height</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>width</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>nBins</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::unordered_map&lt; std::string, std::pair&lt; std::vector&lt; double &gt;, std::vector&lt; int64_t &gt; &gt; &gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>retval</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>nThreads</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This is the function which does most of calculations for the distribution calculation. First the <a class="el" href="#ga35e7a4ba699446c10acceaefb14dfe4b">findMinMax()</a> function is called to find the minimum and maximum pixel values within the raster. Then the <a class="el" href="#ga676f599eaf7356e8cf8faf7aeb69db58">setBins()</a> function is called to set the bin values depending on the minumum and maximum values within the raster. Next, the <a class="el" href="#gad5cb943b118a5d31fed98224cb9c2222">populationDistribution()</a> function is ran to determine the population distribution within the calculated raster bins. Finally, if the user provided a sample layer to compare against, the <a class="el" href="#ga7e242c353e4cf32897948d663a8b4196">sampleDistribution()</a> function is called to determine the distribution within that particular sample.</p>
<p>Both the <a class="el" href="#ga35e7a4ba699446c10acceaefb14dfe4b">findMinMax()</a> and <a class="el" href="#gad5cb943b118a5d31fed98224cb9c2222">populationDistribution()</a> function are called multiple times, each with a different chunk (where the chunk count and chunk size is determined by the number of threads).</p>
<p>To synchronize the calculations within both of those functions, a condition variable is used. The condition variable ensures the function does not continue calculation before ALL chunks of the raster have been checked.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">RasterBandMetaData&amp;</td><td>band </td></tr>
    <tr><td class="paramname">std::vector&lt;Index&gt;&amp;</td><td>sampled </td></tr>
    <tr><td class="paramname">int</td><td>height </td></tr>
    <tr><td class="paramname">int</td><td>width </td></tr>
    <tr><td class="paramname">int</td><td>nBins </td></tr>
    <tr><td class="paramname">std::unordered_map&lt;std::string,std::pair&lt;std::vector&lt;double&gt;,std::vector&lt;int64_t&gt;&gt;&gt;&amp;</td><td>retval </td></tr>
    <tr><td class="paramname">int</td><td>nThreads </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ga5b7558f2557df9cb94b6c4bb8a779e29" name="ga5b7558f2557df9cb94b6c4bb8a779e29"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga5b7558f2557df9cb94b6c4bb8a779e29">&#9670;&#160;</a></span>dist()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::unordered_map&lt; std::string, std::pair&lt; std::vector&lt; double &gt;, std::vector&lt; int64_t &gt; &gt; &gt; sgs::dist::dist </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classsgs_1_1raster_1_1GDALRasterWrapper.html">raster::GDALRasterWrapper</a> *</td>          <td class="paramname"><span class="paramname"><em>p_raster</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>index</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classsgs_1_1vector_1_1GDALVectorWrapper.html">vector::GDALVectorWrapper</a> *</td>          <td class="paramname"><span class="paramname"><em>p_vector</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string</td>          <td class="paramname"><span class="paramname"><em>layer</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>nBins</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>nThreads</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This function calculates the distribution of a particular raster band, and potentially the distribution of a provided sample network of the same raster band.</p>
<p>First, if there is a sample network provided, all of the points are iterated through and converted to x/y index values usign the inverse geotransform (GDALInvGeoTransform()).</p>
<p>After that, band metadata is acquired, and the calculateDistribution() function is called with a template parameter depending on the raster type. After which, the return variable (which was populated in calculateDistribution()) is returned. This variable is a map where the key is either 'population' or 'sample' to specify whether the distribution of the population or a sample distribution. The pair of vectors represent the bins and counts per bin.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">GDALRasterWrapper</td><td>*p_raster </td></tr>
    <tr><td class="paramname">int</td><td>index </td></tr>
    <tr><td class="paramname">GDALVectorWrapper</td><td>*p_vector </td></tr>
    <tr><td class="paramname">std::string</td><td>layer </td></tr>
    <tr><td class="paramname">int</td><td>nBins </td></tr>
    <tr><td class="paramname">int</td><td>nThreads </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>std::unordered_map&lt;std::string, std::pari&lt;std::vector&lt;double&gt;, std::vector&lt;int64_t&gt;&gt;&gt; </dd></dl>

</div>
</div>
<a id="ga35e7a4ba699446c10acceaefb14dfe4b" name="ga35e7a4ba699446c10acceaefb14dfe4b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga35e7a4ba699446c10acceaefb14dfe4b">&#9670;&#160;</a></span>findMinMax()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void sgs::dist::findMinMax </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structsgs_1_1helper_1_1RasterBandMetaData.html">helper::RasterBandMetaData</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>band</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>width</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>yStartBlock</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>yEndBlock</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">T &amp;</td>          <td class="paramname"><span class="paramname"><em>min</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">T &amp;</td>          <td class="paramname"><span class="paramname"><em>max</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::mutex &amp;</td>          <td class="paramname"><span class="paramname"><em>mutex</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::condition_variable &amp;</td>          <td class="paramname"><span class="paramname"><em>cv</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool &amp;</td>          <td class="paramname"><span class="paramname"><em>finished</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This is a helper function for finding the minimum and maximum values within a given raster band.</p>
<p>The min and max variables are passed as references, and the min value is initialized to the largest value the data type can have, and the max value is initialized to the smallest value the data type can have.</p>
<p>This function is provided with a particular chunk of the raster to process in blocks. Different threads are given different chunks. This function iterates through the blocks, reads them into memory, then iterates through each pixel in the block. If a pixel is nan (noData) it isn't counted, otherwise the miniumum and maximum values are updated.</p>
<p>Because the raster band is processed in chunks where each chunk is processed by a different thread, we need to ensure the main thread doesn't continue execution before one of the child threads has finished looking at every pixel in it's chunk. For this reason, a conditional variable is used alongside an array of values which keeps track of which chunks are completed. When this thread has finished checking every pixel, it acquires the lock (mutex) associated with the condition variable, updates the boolean value to indicate completion, releases the lock, then notifies all waiting threads in the condition variable. The main thread will wait at the condition variable, checking the array every time it wakes up to see whether the thread which awoke it was the final chunk completed.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">RasterBandMetaData&amp;</td><td>band </td></tr>
    <tr><td class="paramname">int</td><td>width </td></tr>
    <tr><td class="paramname">int</td><td>yStartBlock </td></tr>
    <tr><td class="paramname">int</td><td>yEndBlock </td></tr>
    <tr><td class="paramname">T&amp;</td><td>min </td></tr>
    <tr><td class="paramname">T&amp;</td><td>max </td></tr>
    <tr><td class="paramname">std::mutex&amp;</td><td>mutex </td></tr>
    <tr><td class="paramname">std::condition_variable&amp;</td><td>cv </td></tr>
    <tr><td class="paramname">bool&amp;</td><td>finished </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="gad5cb943b118a5d31fed98224cb9c2222" name="gad5cb943b118a5d31fed98224cb9c2222"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gad5cb943b118a5d31fed98224cb9c2222">&#9670;&#160;</a></span>populationDistribution()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void sgs::dist::populationDistribution </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structsgs_1_1helper_1_1RasterBandMetaData.html">helper::RasterBandMetaData</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>band</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>width</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>yBlockStart</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>yBlockEnd</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>nBins</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; T &gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>binVals</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; int64_t &gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>counts</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::mutex &amp;</td>          <td class="paramname"><span class="paramname"><em>mutex</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::condition_variable &amp;</td>          <td class="paramname"><span class="paramname"><em>cv</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool &amp;</td>          <td class="paramname"><span class="paramname"><em>finished</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This function calculates the distribution of pixels across the entire population (the whole raster band).</p>
<p>The chunk of the raster assigned to this call of the function is iterated through in blocks. All of the pixels in each block are then iterated through, the nan values are ignored.</p>
<p>The bin values are passed as a parameter, and the value in the vector represents the start of a particular bin. This means that the first index in the bins vector which is less than or equal to a particular pixel, is that pixles bin. For each pixel, the iteration starts at the largest bin and iterates down until it reaches a bin value less than or equal to a particular pixel.</p>
<p>Because the raster band is processed in chunks where each chunk is processed by a different thread, we need to ensure the main thread doesn't continue execution before one of the child threads has finished looking at every pixel in it's chunk. For this reason, a conditional variable is used alongside an array of values which keeps track of which chunks are completed. When this thread has finished checking every pixel, it acquires the lock (mutex) associated with the condition variable, updates the boolean value to indicate completion, releases the lock, then notifies all waiting threads in the condition variable. The main thread will wait at the condition variable, checking the array every time it wakes up to see whether the thread which awoke it was the final chunk completed.</p>
<p>The global vector of counts is passed as a reference to this function. This global 'counts' parameter is not updated when iterating through the raster to avoid race conditions. Rather, a separate 'chunkCounts' vector which is local to a particular call of this function is updated constantly. Then, when the lock is acquired the global count vector is updated befor releasing the lock.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">RasterBandMetaData&amp;</td><td>band </td></tr>
    <tr><td class="paramname">int</td><td>width </td></tr>
    <tr><td class="paramname">int</td><td>yBlockStart </td></tr>
    <tr><td class="paramname">int</td><td>yBlockEnd </td></tr>
    <tr><td class="paramname">int</td><td>nBins </td></tr>
    <tr><td class="paramname">std::vector&lt;T&gt;&amp;</td><td>binVals </td></tr>
    <tr><td class="paramname">std::vector&lt;int64_t&gt;&amp;</td><td>counts </td></tr>
    <tr><td class="paramname">std::mutex&amp;</td><td>mutex </td></tr>
    <tr><td class="paramname">std::condition_variable&amp;</td><td>cv </td></tr>
    <tr><td class="paramname">bool&amp;</td><td>finished </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ga7e242c353e4cf32897948d663a8b4196" name="ga7e242c353e4cf32897948d663a8b4196"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga7e242c353e4cf32897948d663a8b4196">&#9670;&#160;</a></span>sampleDistribution()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt; int64_t &gt; sgs::dist::sampleDistribution </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structsgs_1_1helper_1_1RasterBandMetaData.html">helper::RasterBandMetaData</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>band</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="structsgs_1_1helper_1_1Index.html">helper::Index</a> &gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>samples</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; T &gt;</td>          <td class="paramname"><span class="paramname"><em>binVals</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>nBins</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This function calculates the probability distribution of a sample network, if a vector layer of samples was provided. It takes the same bin values as the population, and iterates through each sample index. The sample index is read from the raster band using the GDALRasterBand::RasterIO function. The bins counts are updated accordingly.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">RasterBandMetaData&amp;</td><td>band </td></tr>
    <tr><td class="paramname">std::vector&lt;Index&gt;*</td><td>samples </td></tr>
    <tr><td class="paramname">std::vector&lt;T&gt;</td><td>binVals </td></tr>
    <tr><td class="paramname">int</td><td>nBins </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ga676f599eaf7356e8cf8faf7aeb69db58" name="ga676f599eaf7356e8cf8faf7aeb69db58"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga676f599eaf7356e8cf8faf7aeb69db58">&#9670;&#160;</a></span>setBins()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void sgs::dist::setBins </td>
          <td>(</td>
          <td class="paramtype">T</td>          <td class="paramname"><span class="paramname"><em>min</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">T</td>          <td class="paramname"><span class="paramname"><em>max</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>nBins</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GDALDataType</td>          <td class="paramname"><span class="paramname"><em>type</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; double &gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>dbins</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; T &gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>tbins</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This function calculates the bin values for the distribution.</p>
<p>It takes miniumum and maximum values as parameters. A vector of double values is created to represent the bins, in addition to a vector of the data type of the raster pixels. The vector of doubles is the one returned to the user, the vector of the raster pixel type is used to calculate which bin a particular pixel goes into while iterating through the raster.</p>
<p>The reason why there is an additional vector with the rasters data type is that it will reduce the potentialy overhead of requiring the program to cast the pixel type to double to calculate the bin for every pixel. However, it also means that for integer values a simple static cast will not work, because it will always truncate the value. If the actual bin stops at 10.1, but the vin says 10 instead of 11, then pixels with value 10 will be placed into the wrong bin. The bin value represents the START value of the bin. The final parameter of the double bin is the 'cap' and represents the end of the last bini, as is customary. The raster pixel type bin vector does not have this cap value, as it is not necessary.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">T</td><td>min </td></tr>
    <tr><td class="paramname">T</td><td>max </td></tr>
    <tr><td class="paramname">int</td><td>nBins </td></tr>
    <tr><td class="paramname">GDALDataType</td><td>type </td></tr>
    <tr><td class="paramname">std::vector&lt;double&gt;&amp;</td><td>bins </td></tr>
    <tr><td class="paramname">std::vector&lt;T&gt;&amp;</td><td>bins </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
