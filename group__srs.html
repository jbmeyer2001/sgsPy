<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>sgsPy: srs</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">sgsPy
   </div>
   <div id="projectbrief">structurally guided sampling</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('group__srs.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">srs <div class="ingroups"><a class="el" href="group__dev.html">Developer Documentation</a> &raquo; <a class="el" href="group__sample.html">sample</a></div></div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-func-members" class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gacdc25256ccd62049b664df2f7b1ce35b" id="r_gacdc25256ccd62049b664df2f7b1ce35b"><td class="memTemplParams" colspan="2">template&lt;typename T&gt; </td></tr>
<tr class="memitem:gacdc25256ccd62049b664df2f7b1ce35b template"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gacdc25256ccd62049b664df2f7b1ce35b">sgs::srs::processBlock</a> (<a class="el" href="structsgs_1_1helper_1_1RasterBandMetaData.html">helper::RasterBandMetaData</a> &amp;band, <a class="el" href="structsgs_1_1access_1_1Access.html">access::Access</a> &amp;access, <a class="el" href="structsgs_1_1existing_1_1Existing.html">existing::Existing</a> &amp;existing, std::vector&lt; <a class="el" href="structsgs_1_1helper_1_1Index.html">helper::Index</a> &gt; &amp;indices, <a class="el" href="classsgs_1_1helper_1_1RandValController.html">helper::RandValController</a> &amp;rand, int xBlock, int yBlock, int xValid, int yValid)</td></tr>
<tr class="memitem:gacfa7730e4778a314a798ca0c233720d2" id="r_gacfa7730e4778a314a798ca0c233720d2"><td class="memItemLeft" align="right" valign="top">std::tuple&lt; std::vector&lt; std::vector&lt; double &gt; &gt;, <a class="el" href="classsgs_1_1vector_1_1GDALVectorWrapper.html">vector::GDALVectorWrapper</a> *, size_t &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gacfa7730e4778a314a798ca0c233720d2">sgs::srs::srs</a> (<a class="el" href="classsgs_1_1raster_1_1GDALRasterWrapper.html">raster::GDALRasterWrapper</a> *p_raster, size_t numSamples, double mindist, <a class="el" href="classsgs_1_1vector_1_1GDALVectorWrapper.html">vector::GDALVectorWrapper</a> *p_existing, <a class="el" href="classsgs_1_1vector_1_1GDALVectorWrapper.html">vector::GDALVectorWrapper</a> *p_access, std::string layerName, double buffInner, double buffOuter, bool plot, std::string tempFolder, std::string filename)</td></tr>
</table>
<a name="details" id="details"></a><h2 id="header-details" class="groupheader">Detailed Description</h2>
<a name="doc-func-members" id="doc-func-members"></a><h2 id="header-doc-func-members" class="groupheader">Function Documentation</h2>
<a id="gacdc25256ccd62049b664df2f7b1ce35b" name="gacdc25256ccd62049b664df2f7b1ce35b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gacdc25256ccd62049b664df2f7b1ce35b">&#9670;&#160;</a></span>processBlock()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void sgs::srs::processBlock </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structsgs_1_1helper_1_1RasterBandMetaData.html">helper::RasterBandMetaData</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>band</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structsgs_1_1access_1_1Access.html">access::Access</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>access</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structsgs_1_1existing_1_1Existing.html">existing::Existing</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>existing</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="structsgs_1_1helper_1_1Index.html">helper::Index</a> &gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>indices</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classsgs_1_1helper_1_1RandValController.html">helper::RandValController</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>rand</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>xBlock</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>yBlock</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>xValid</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>yValid</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel inline">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>This is a helper function for processing a block of the raster. For each pixel in the block: The value is checked, and not added if it is a nanvalue. The pixel is checked to ensure it is within an accessible area. The pixel is checked to ensure it hasn't already been added as a pre-existing sample point. The next rng value is checked to see whether it is one of the chosen pixels to be added.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">RasterBandMetaData&amp;</td><td>band </td></tr>
    <tr><td class="paramname">Access&amp;</td><td>access </td></tr>
    <tr><td class="paramname">Existing&amp;</td><td>existing </td></tr>
    <tr><td class="paramname">std::vector&lt;Index&gt;&amp;</td><td>indices </td></tr>
    <tr><td class="paramname">std::vector&lt;Index&gt;&amp;</td><td>randVals, </td></tr>
    <tr><td class="paramname">int&amp;</td><td>randValIndex </td></tr>
    <tr><td class="paramname">int</td><td>xBlock </td></tr>
    <tr><td class="paramname">int</td><td>yBlock </td></tr>
    <tr><td class="paramname">int</td><td>xValid </td></tr>
    <tr><td class="paramname">int</td><td>yValid </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="gacfa7730e4778a314a798ca0c233720d2" name="gacfa7730e4778a314a798ca0c233720d2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gacfa7730e4778a314a798ca0c233720d2">&#9670;&#160;</a></span>srs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::tuple&lt; std::vector&lt; std::vector&lt; double &gt; &gt;, <a class="el" href="classsgs_1_1vector_1_1GDALVectorWrapper.html">vector::GDALVectorWrapper</a> *, size_t &gt; sgs::srs::srs </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classsgs_1_1raster_1_1GDALRasterWrapper.html">raster::GDALRasterWrapper</a> *</td>          <td class="paramname"><span class="paramname"><em>p_raster</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>numSamples</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double</td>          <td class="paramname"><span class="paramname"><em>mindist</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classsgs_1_1vector_1_1GDALVectorWrapper.html">vector::GDALVectorWrapper</a> *</td>          <td class="paramname"><span class="paramname"><em>p_existing</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classsgs_1_1vector_1_1GDALVectorWrapper.html">vector::GDALVectorWrapper</a> *</td>          <td class="paramname"><span class="paramname"><em>p_access</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string</td>          <td class="paramname"><span class="paramname"><em>layerName</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double</td>          <td class="paramname"><span class="paramname"><em>buffInner</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double</td>          <td class="paramname"><span class="paramname"><em>buffOuter</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>plot</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string</td>          <td class="paramname"><span class="paramname"><em>tempFolder</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string</td>          <td class="paramname"><span class="paramname"><em>filename</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This function uses random sampling to determine the location of sample plots given a raster image.</p>
<p>First, metadata is acquired on the first raster band, which is to be read to check and ensure samples don't occur over nodata pixels.</p>
<p>Next, and output vector dataset is created as an in-memory dataset. If the user specifies a filename, this in-memory dataset will be written to disk in a different format after all points have been added.</p>
<p>An Access struct is created, which creates a raster dataset containing a rasterized version of access buffers. This raster will be 1 over accessible areas. In the case where there is no access vector given, the structs 'used' member will be false and no processing or rasterization will be done.</p>
<p>An Existing struct is created, which retains information on already existing sample points passed in the form of a vector dataset. The points are iterated through and added to the output dataset. The points are also added to a set, and during iteration the indexes of every pixel will be checked against this set to ensure there are no duplicate pixels. In the case whre there is no existing vector given, the structs 'used' member will be false and no processing will be done.</p>
<p>Next, a rng() function is created usign the xoshiro library, the specific randm number generator is the xoshrio256++ <a href="https://vigna.di.unimi.it/ftp/papers/ScrambledLinear.pdf">https://vigna.di.unimi.it/ftp/papers/ScrambledLinear.pdf</a> <br  />
</p>
<p>The impetus behind usign the rng() function to determine which pixels should be added DURING iteration, rather than afterwards, is it removes the necessity of storing every available pixel, which quickly becomes extrordinarily inefficient for large rasters. Rather, for pixels which are accessible, not nan, and not already existing, there is a pre-determined percentage chance to be stored which uses this random number generator. An over-estimation for the percentage chance is made, because it is better to have too many than not enough possible options to sample from. This over-estimation might result in the storage of 2x-3x extra pixels rather than the many orders of magnitude extra storage of adding all pixels. The calculation for this percentage is done and explained in detail in the getProbabilityMultiplier() function.</p>
<p>The raster is then processed in blocks, each block is read into memory, and potentially the block of the access raster is read into memory as well. The <a class="el" href="#gacdc25256ccd62049b664df2f7b1ce35b">processBlock()</a> funciton is called depending on the data type of the raster, to add the available / chosen pixel indices.</p>
<p>Once the entire raster has been iterated through, there may be extra indices in the indicies vector. Because simply sampling the first few we need would NOT be random, the indices are first shuffled. After being shuffled, the indexes are added to the output dataset as samples if they don't occur within mindist if an already existing pixel.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">GDALRasterWrapper</td><td>*p_raster </td></tr>
    <tr><td class="paramname">size_t</td><td>numSamples </td></tr>
    <tr><td class="paramname">double</td><td>mindist </td></tr>
    <tr><td class="paramname">GDALVectorWrapper</td><td>*p_existing </td></tr>
    <tr><td class="paramname">GDALVectorWrapper</td><td>*p_access </td></tr>
    <tr><td class="paramname">std::string</td><td>layerName </td></tr>
    <tr><td class="paramname">double</td><td>buffInner </td></tr>
    <tr><td class="paramname">double</td><td>buffOuter </td></tr>
    <tr><td class="paramname">bool</td><td>plot </td></tr>
    <tr><td class="paramname">std::string</td><td>tempFolder </td></tr>
    <tr><td class="paramname">std::string</td><td>filename </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>std::tuple&lt;std::vector&lt;std::vector&lt;double&gt;&gt;, GDALVectorWrapper *, size_t&gt; </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
