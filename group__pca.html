<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>sgsPy: pca</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">sgsPy
   </div>
   <div id="projectbrief">structurally guided sampling</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('group__pca.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">pca <div class="ingroups"><a class="el" href="group__dev.html">Developer Documentation</a> &raquo; <a class="el" href="group__calculate.html">calculate</a></div></div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-nested-classes" class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:sgs_3A_3Apca_3A_3APCAResult_3C_20T_20_3E" id="r_sgs_3A_3Apca_3A_3APCAResult_3C_20T_20_3E"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structsgs_1_1pca_1_1PCAResult.html">sgs::pca::PCAResult&lt; T &gt;</a></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-func-members" class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gac7211f5c5424c53e61a79472e38e946f" id="r_gac7211f5c5424c53e61a79472e38e946f"><td class="memTemplParams" colspan="2">template&lt;typename T&gt; </td></tr>
<tr class="memitem:gac7211f5c5424c53e61a79472e38e946f template"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structsgs_1_1pca_1_1PCAResult.html">PCAResult</a>&lt; T &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gac7211f5c5424c53e61a79472e38e946f">sgs::pca::calculatePCA</a> (std::vector&lt; <a class="el" href="structsgs_1_1helper_1_1RasterBandMetaData.html">helper::RasterBandMetaData</a> &gt; &amp;bands, GDALDataType type, size_t size, int width, int height, int nComp)</td></tr>
<tr class="memitem:gad25371ddc3f72c66aef25accb84faa3c" id="r_gad25371ddc3f72c66aef25accb84faa3c"><td class="memTemplParams" colspan="2">template&lt;typename T&gt; </td></tr>
<tr class="memitem:gad25371ddc3f72c66aef25accb84faa3c template"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structsgs_1_1pca_1_1PCAResult.html">PCAResult</a>&lt; T &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gad25371ddc3f72c66aef25accb84faa3c">sgs::pca::calculatePCA</a> (std::vector&lt; <a class="el" href="structsgs_1_1helper_1_1RasterBandMetaData.html">helper::RasterBandMetaData</a> &gt; &amp;bands, GDALDataType type, size_t size, int xBlockSize, int yBlockSize, int xBlocks, int yBlocks, int nComp)</td></tr>
<tr class="memitem:ga433cb49aafdfc74b270e3c626ad310f3" id="r_ga433cb49aafdfc74b270e3c626ad310f3"><td class="memTemplParams" colspan="2">template&lt;typename T&gt; </td></tr>
<tr class="memitem:ga433cb49aafdfc74b270e3c626ad310f3 template"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga433cb49aafdfc74b270e3c626ad310f3">sgs::pca::writePCA</a> (std::vector&lt; <a class="el" href="structsgs_1_1helper_1_1RasterBandMetaData.html">helper::RasterBandMetaData</a> &gt; &amp;bands, std::vector&lt; <a class="el" href="structsgs_1_1helper_1_1RasterBandMetaData.html">helper::RasterBandMetaData</a> &gt; &amp;PCABands, <a class="el" href="structsgs_1_1pca_1_1PCAResult.html">PCAResult</a>&lt; T &gt; &amp;result, GDALDataType type, size_t size, int height, int width)</td></tr>
<tr class="memitem:ga3a88c12ff7fca58c31cc11267e78500d" id="r_ga3a88c12ff7fca58c31cc11267e78500d"><td class="memTemplParams" colspan="2">template&lt;typename T&gt; </td></tr>
<tr class="memitem:ga3a88c12ff7fca58c31cc11267e78500d template"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga3a88c12ff7fca58c31cc11267e78500d">sgs::pca::writePCA</a> (std::vector&lt; <a class="el" href="structsgs_1_1helper_1_1RasterBandMetaData.html">helper::RasterBandMetaData</a> &gt; &amp;bands, std::vector&lt; <a class="el" href="structsgs_1_1helper_1_1RasterBandMetaData.html">helper::RasterBandMetaData</a> &gt; &amp;PCABands, <a class="el" href="structsgs_1_1pca_1_1PCAResult.html">PCAResult</a>&lt; T &gt; &amp;result, GDALDataType type, size_t size, int xBlockSize, int yBlockSize, int xBlocks, int yBlocks)</td></tr>
<tr class="memitem:ga37835a150a0b66ce17be0dac0fc77d82" id="r_ga37835a150a0b66ce17be0dac0fc77d82"><td class="memItemLeft" align="right" valign="top">std::tuple&lt; <a class="el" href="classsgs_1_1raster_1_1GDALRasterWrapper.html">raster::GDALRasterWrapper</a> *, std::vector&lt; std::vector&lt; double &gt; &gt;, std::vector&lt; double &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga37835a150a0b66ce17be0dac0fc77d82">sgs::pca::pca</a> (<a class="el" href="classsgs_1_1raster_1_1GDALRasterWrapper.html">raster::GDALRasterWrapper</a> *p_raster, int nComp, bool largeRaster, std::string tempFolder, std::string filename, std::map&lt; std::string, std::string &gt; driverOptions)</td></tr>
</table>
<a name="details" id="details"></a><h2 id="header-details" class="groupheader">Detailed Description</h2>
<a name="doc-func-members" id="doc-func-members"></a><h2 id="header-doc-func-members" class="groupheader">Function Documentation</h2>
<a id="gac7211f5c5424c53e61a79472e38e946f" name="gac7211f5c5424c53e61a79472e38e946f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gac7211f5c5424c53e61a79472e38e946f">&#9670;&#160;</a></span>calculatePCA() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structsgs_1_1pca_1_1PCAResult.html">PCAResult</a>&lt; T &gt; sgs::pca::calculatePCA </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; <a class="el" href="structsgs_1_1helper_1_1RasterBandMetaData.html">helper::RasterBandMetaData</a> &gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>bands</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GDALDataType</td>          <td class="paramname"><span class="paramname"><em>type</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>size</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>width</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>height</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>nComp</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This function is used by the <a class="el" href="namespacesgs_1_1calculate_1_1pca_1_1pca.html">pca()</a> function to calculate the principal component eigenvectors and eigenvalues, along with the mean and standard deviation of each input raster band. This function is used in the case where the input raster is small, and can reasonably be expected to fit entirely into memory.</p>
<p>First, the input raster bands are read into memory usign the GDALRasterBand RasterIO function. Bands are read into memory in a row-wise manor such that a row indicates a single pixel, and a column indicates a raster band. This means that in between each pixel and the next, a gap must be left for the remaining band values for that pixel index to be written to. This is done using the nPixelSpace, and nLineSpace arguments of RasterIO.</p>
<p>Second, each pixel is checked to ensure it isn't a nan pixel. Any pixel containing a nan value in any band is overwritten completely with the next not-nan pixel, the total number of not-nan pixels is stored as the number of features.</p>
<p>The mean, standard deviation are then calculated using Welfords method, and the pca eigenvectors and eigenvalues are calculated using the oneDAL library principal components functionality.</p>
<p>A result containing the eigenvectors, eigenvalues, mean per band, and standard deviation per band, is returned.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">std::vector&lt;RasterBandMetaData&gt;&amp;</td><td>bands, </td></tr>
    <tr><td class="paramname">GDALDataType</td><td>type </td></tr>
    <tr><td class="paramname">size_t</td><td>size </td></tr>
    <tr><td class="paramname">int</td><td>width </td></tr>
    <tr><td class="paramname">int</td><td>height </td></tr>
    <tr><td class="paramname">int</td><td>nComp </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PCAResult&lt;T&gt; </dd></dl>

</div>
</div>
<a id="gad25371ddc3f72c66aef25accb84faa3c" name="gad25371ddc3f72c66aef25accb84faa3c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gad25371ddc3f72c66aef25accb84faa3c">&#9670;&#160;</a></span>calculatePCA() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structsgs_1_1pca_1_1PCAResult.html">PCAResult</a>&lt; T &gt; sgs::pca::calculatePCA </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; <a class="el" href="structsgs_1_1helper_1_1RasterBandMetaData.html">helper::RasterBandMetaData</a> &gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>bands</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GDALDataType</td>          <td class="paramname"><span class="paramname"><em>type</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>size</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>xBlockSize</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>yBlockSize</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>xBlocks</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>yBlocks</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>nComp</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This function is used by the <a class="el" href="namespacesgs_1_1calculate_1_1pca_1_1pca.html">pca()</a> function to calculate the principal component eigenvectors and eigenvalues, along with the mean and standard deviation of each input raster band. This function is used in the case where the input raster is large, will be processed in blocks.</p>
<p>All of the blocks are iterated through, and within each iteration the following is done:</p>
<p>First, the input raster band blocks are read into memory using the GDALRasterBand RasterIO function. Bands are read into memory in a row-wise manor such that a row indicates a single pixel, and a column indicates a raster band. This means that in between each pixel and the next, a gap must be left for the remaining band values for that pixel index to be written to. This is done using the nPixelSpace, and nLineSpace arguments of RasterIO.</p>
<p>Second, each pixel is checked to ensure it isn't a nan pixel. Any pixel containing a nan value in any band is overwritten completely with the next not-nan pixel, the total number of not-nan pixels is stored as the number of features.</p>
<p>The mean, standard deviation are then updated using Welfords method, and the pca eigenvectors and eigenvalues partial result are updated using the oneDAL library principal components functionality.</p>
<p>once all blocks have been iterated through, the final resulting mean per band, standard deviation per band, eigenvectors, and eigenvalues are calculated and returned.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">std::vector&lt;RasterBandMetaData&gt;&amp;</td><td>bands </td></tr>
    <tr><td class="paramname">GDALDataType</td><td>type </td></tr>
    <tr><td class="paramname">size_t</td><td>size </td></tr>
    <tr><td class="paramname">int</td><td>xBlockSize </td></tr>
    <tr><td class="paramname">int</td><td>yBlockSize </td></tr>
    <tr><td class="paramname">int</td><td>xBlocks </td></tr>
    <tr><td class="paramname">int</td><td>yBlocks </td></tr>
    <tr><td class="paramname">int</td><td>nComp </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PCAResult&lt;T&gt; </dd></dl>

</div>
</div>
<a id="ga37835a150a0b66ce17be0dac0fc77d82" name="ga37835a150a0b66ce17be0dac0fc77d82"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga37835a150a0b66ce17be0dac0fc77d82">&#9670;&#160;</a></span>pca()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::tuple&lt; <a class="el" href="classsgs_1_1raster_1_1GDALRasterWrapper.html">raster::GDALRasterWrapper</a> *, std::vector&lt; std::vector&lt; double &gt; &gt;, std::vector&lt; double &gt; &gt; sgs::pca::pca </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classsgs_1_1raster_1_1GDALRasterWrapper.html">raster::GDALRasterWrapper</a> *</td>          <td class="paramname"><span class="paramname"><em>p_raster</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>nComp</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>largeRaster</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string</td>          <td class="paramname"><span class="paramname"><em>tempFolder</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string</td>          <td class="paramname"><span class="paramname"><em>filename</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::map&lt; std::string, std::string &gt;</td>          <td class="paramname"><span class="paramname"><em>driverOptions</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This function conducts principal component analysis on the input raster, writing output bands to a new GDALRasterWrapper, and returning the eigenvectors and eigenvalues calculated for each raster band. The output values are both centered and scaled before being projected onto the pca eigenvectors.</p>
<p>First, depending on whether the raster is large (should be processed in blocks) or not, and whether an output filename is given, an output dataset is created to store the output results. In the case of a small raster without a given filename, an in-memory raster is created. In the case of a large raster without a given filename, a VRT dataset is created where each VRT band is a GTiff raster. When a filename is created, the driver which corresponds to that filename is used.</p>
<p>Then, the calculatePCA() function is called, with specific template parameters depending on the data type, and a specific function overload depending on whether the raster should be processed by blocks. This function calculates the principal component eigenvectors, eigenvalues, mean per band, and standard deviation per band. The writePCA() function is then called (again with specific template and overload) to center, scale, and project the input raster values to output pca bands which are written to the output dataset.</p>
<p>Finally, a GDALRasterWrapper is created using the output dataset, and returned in a tuple alongside the eigenvectors and eigenvalues.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">GDALRasterWrapper</td><td>*p_raster </td></tr>
    <tr><td class="paramname">int</td><td>nComp </td></tr>
    <tr><td class="paramname">bool</td><td>largeRaster </td></tr>
    <tr><td class="paramname">std::string</td><td>tempFolder </td></tr>
    <tr><td class="paramname">std::string</td><td>filename </td></tr>
    <tr><td class="paramname">std::mape&lt;std::string,std::string&gt;</td><td>driverOptions </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>std::tuple&lt; GDALRasterWrapper *, std::vector&lt;std::vector&lt;double&gt;&gt; std::vector&lt;double&gt; &gt; </dd></dl>

</div>
</div>
<a id="ga433cb49aafdfc74b270e3c626ad310f3" name="ga433cb49aafdfc74b270e3c626ad310f3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga433cb49aafdfc74b270e3c626ad310f3">&#9670;&#160;</a></span>writePCA() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void sgs::pca::writePCA </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; <a class="el" href="structsgs_1_1helper_1_1RasterBandMetaData.html">helper::RasterBandMetaData</a> &gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>bands</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="structsgs_1_1helper_1_1RasterBandMetaData.html">helper::RasterBandMetaData</a> &gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>PCABands</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structsgs_1_1pca_1_1PCAResult.html">PCAResult</a>&lt; T &gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>result</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GDALDataType</td>          <td class="paramname"><span class="paramname"><em>type</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>size</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>height</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>width</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This function is used to write the output principal components to a raster dataset, after the eigenvectors and eigenvalues have already been calculated for the input raster. This function is used in the case where the raster is small, and would not be expected to cause errors for being entirely in memory.</p>
<p>First, the input raster bands are read into memory using the GDALRasterBand RasterIO function. Bands are read into memory in a row-wise manor such that a row indicates a single pixel, and a column indicates a raster band. This means that in between each pixel and the next, a gap must be left for the remaining band values for that pixel index to be written to. This is done using the nPixelSpace, and nLineSpace arguments of RasterIO. The data pixels are iterated over: scaled, shifted, and set to nan if at a no data pixel.</p>
<p>Next, a matrix of pca eigenvectors are allocated and read into a new location.</p>
<p>Both the data matrix and the pca matrix are turned into oneDAL homogen tables, and the result of a linear kernel calculation is written to the output.</p>
<p>The reason a linear kernel is used, is because the result is essentially just a bunch of dot products. It's possible to do these dot products one at a time for each output pixel and component. However, the linear kernel, which is originally meant for fast machine learning use, does exactly what we need.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">std::vector&lt;RasterBandMetaData&gt;&amp;</td><td>bands </td></tr>
    <tr><td class="paramname">std::vector&lt;rasterBandMetaData&gt;&amp;</td><td>PCABands </td></tr>
    <tr><td class="paramname">PCAResult&lt;T&gt;&amp;</td><td>result, </td></tr>
    <tr><td class="paramname">GDALDataType</td><td>type, </td></tr>
    <tr><td class="paramname">size_t</td><td>size, </td></tr>
    <tr><td class="paramname">int</td><td>height </td></tr>
    <tr><td class="paramname">int</td><td>width </td></tr>
  </table>
  </dd>
</dl>
<p>the result for each output principal component pixel is just the dot product of that pixel's data values with the corresponding principal component eigenvector.</p>
<p>oneDAL has a fast way to calculate dot products which is originally meant to be used for machine learning, but it does exactly what we need &ndash; multiply large matrices.</p>

</div>
</div>
<a id="ga3a88c12ff7fca58c31cc11267e78500d" name="ga3a88c12ff7fca58c31cc11267e78500d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga3a88c12ff7fca58c31cc11267e78500d">&#9670;&#160;</a></span>writePCA() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void sgs::pca::writePCA </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; <a class="el" href="structsgs_1_1helper_1_1RasterBandMetaData.html">helper::RasterBandMetaData</a> &gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>bands</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="structsgs_1_1helper_1_1RasterBandMetaData.html">helper::RasterBandMetaData</a> &gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>PCABands</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structsgs_1_1pca_1_1PCAResult.html">PCAResult</a>&lt; T &gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>result</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GDALDataType</td>          <td class="paramname"><span class="paramname"><em>type</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>size</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>xBlockSize</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>yBlockSize</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>xBlocks</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>yBlocks</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This function is used to write the output principal components to a raster dataset, after the eigenvectors and eigenvalues have already been calculated for the input raster. This function is used in the case where the raster is large, and should be processed in blocks.</p>
<p>For each block:</p>
<p>First, the input raster bands are read into memory using the GDALRasterBand RasterIO function. Bands are read into memory in a row-wise manor such that a row indicates a single pixel, and a column indicates a raster band. This means that in between each pixel and the next, a gap must be left for the remaining band values for that pixel index to be written to. This is done using the nPixelSpace, and nLineSpace arguments of RasterIO. The data pixels are iterated over: scaled, shifted, and set to nan if at a no data pixel.</p>
<p>Next, a matrix of pca eigenvectors are allocated and read into a new location.</p>
<p>Both the data matrix and the pca matrix are turned into oneDAL homogen tables, and the result of a linear kernel calculation is written to the output.</p>
<p>The reason a linear kernel is used, is because the result is essentially just a bunch of dot products. It's possible to do these dot products one at a time for each output pixel and component. However, the linear kernel, which is originally meant for fast machine learning use, does exactly what we need.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">std::vector&lt;RasterBandMetaData&gt;&amp;</td><td>bands </td></tr>
    <tr><td class="paramname">std::vector&lt;RasterBandMetaData&gt;&amp;</td><td>PCABands </td></tr>
    <tr><td class="paramname">PCAResult&lt;T&gt;&amp;</td><td>result </td></tr>
    <tr><td class="paramname">GDALDataType</td><td>type </td></tr>
    <tr><td class="paramname">size_t</td><td>size </td></tr>
    <tr><td class="paramname">int</td><td>xBlockSize </td></tr>
    <tr><td class="paramname">int</td><td>yBlockSize </td></tr>
    <tr><td class="paramname">int</td><td>xBlocks </td></tr>
    <tr><td class="paramname">int</td><td>yBlocks </td></tr>
  </table>
  </dd>
</dl>
<p>the result for each output principal component pixel is just the dot product of that pixel's data values with the corresponding principal component eigenvector.</p>
<p>oneDAL has a fast way to calculate dot products which is originally meant to be used for machine learning (as I understand it) but it does exactly what we need &ndash; multiply large matrices.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
