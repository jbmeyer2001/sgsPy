<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>sgsPy: breaks</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">sgsPy
   </div>
   <div id="projectbrief">structurally guided sampling</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('group__breaks.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">breaks <div class="ingroups"><a class="el" href="group__dev.html">Developer Documentation</a> &raquo; <a class="el" href="group__stratify.html">stratify</a></div></div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-func-members" class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gacbc2118cae477cf128e798fb68aac7e7" id="r_gacbc2118cae477cf128e798fb68aac7e7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gacbc2118cae477cf128e798fb68aac7e7">sgs::breaks::processMapPixel</a> (size_t index, <a class="el" href="structsgs_1_1helper_1_1RasterBandMetaData.html">helper::RasterBandMetaData</a> &amp;dataBand, void *p_dataBuffer, <a class="el" href="structsgs_1_1helper_1_1RasterBandMetaData.html">helper::RasterBandMetaData</a> &amp;stratBand, void *p_stratBuffer, std::vector&lt; double &gt; &amp;bandBreaks, size_t multiplier, bool &amp;mapNan, size_t &amp;mapStrat)</td></tr>
<tr class="memitem:gab1b387a24b954d815715ecdc3f3b170b" id="r_gab1b387a24b954d815715ecdc3f3b170b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gab1b387a24b954d815715ecdc3f3b170b">sgs::breaks::processPixel</a> (size_t index, void *p_data, <a class="el" href="structsgs_1_1helper_1_1RasterBandMetaData.html">helper::RasterBandMetaData</a> *p_dataBand, void *p_strat, <a class="el" href="structsgs_1_1helper_1_1RasterBandMetaData.html">helper::RasterBandMetaData</a> *p_stratBand, std::vector&lt; double &gt; &amp;bandBreaks)</td></tr>
<tr class="memitem:ga6e9e93a996334f510d13f070d69f0781" id="r_ga6e9e93a996334f510d13f070d69f0781"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classsgs_1_1raster_1_1GDALRasterWrapper.html">raster::GDALRasterWrapper</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga6e9e93a996334f510d13f070d69f0781">sgs::breaks::breaks</a> (<a class="el" href="classsgs_1_1raster_1_1GDALRasterWrapper.html">raster::GDALRasterWrapper</a> *p_raster, std::map&lt; int, std::vector&lt; double &gt; &gt; breaks, bool map, std::string filename, bool largeRaster, int threads, std::string tempFolder, std::map&lt; std::string, std::string &gt; driverOptions)</td></tr>
</table>
<a name="details" id="details"></a><h2 id="header-details" class="groupheader">Detailed Description</h2>
<a name="doc-func-members" id="doc-func-members"></a><h2 id="header-doc-func-members" class="groupheader">Function Documentation</h2>
<a id="ga6e9e93a996334f510d13f070d69f0781" name="ga6e9e93a996334f510d13f070d69f0781"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga6e9e93a996334f510d13f070d69f0781">&#9670;&#160;</a></span>breaks()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classsgs_1_1raster_1_1GDALRasterWrapper.html">raster::GDALRasterWrapper</a> * sgs::breaks::breaks </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classsgs_1_1raster_1_1GDALRasterWrapper.html">raster::GDALRasterWrapper</a> *</td>          <td class="paramname"><span class="paramname"><em>p_raster</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::map&lt; int, std::vector&lt; double &gt; &gt;</td>          <td class="paramname"><span class="paramname"><em>breaks</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>map</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string</td>          <td class="paramname"><span class="paramname"><em>filename</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>largeRaster</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>threads</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string</td>          <td class="paramname"><span class="paramname"><em>tempFolder</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::map&lt; std::string, std::string &gt;</td>          <td class="paramname"><span class="paramname"><em>driverOptions</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This function stratifies a given raster using user-defined breaks. The breaks are provided as a vector of doubles for each band specified in the input dataset.</p>
<p>The function can be run on a single raster band or multiple raster bands, and the user may pass the map variable to combine the stratification of multiple raster bands.</p>
<p>The function can be thought of in three different sections: the setup, the processing, and the finish/return. During the setup, metadata is aquired for the input raster, and an output dataset is created which depends on user-given parameters and the input raster. During the processing the input raster is iterated through, either by blocks or with the entire raster in memory, the strata are determined for each pixel and then written to the output dataset. During the finish/return step, a GDALRasterWrapper object is created using the output dataset.</p>
<p>SETUP: the data structures holding metadata are initialized and it is determined whether the raster is a virtual raster or not, and if it is a virtual raster whether it is fully in-memory or whether it must be stored on disk.</p>
<p>If the user provides an output filename, the dataset will not be a virtual dataset instead it will be associated with the filename. If the user does not provide an output filename then a virtual dataset driver will be used. In the case of a large raster (whether or not the raster is large enough for this is calculated and passed by Python side of application), the dataset will be VRT. If the package is comfortable fitting the entire raster in memory an in-memory dataset will be used.</p>
<p>The input raster bands are iterated through, metadata is stored on them, and bands are created for the output dataset. In the case of a VRT dataset, each band is a complete dataset itself which must be added after it has been written to. In the case of a MEM dataset, the bands must be aquired from the input raster. Both MEM and VRT support the AddBand function, and support bands with different types, so the bands are dynamically added while iterating through the input raster bands. Non virtual formats require the data types to be known at dataset initialization and don't support the AddBand function, so the dataset must be created after iterating through the input bands.</p>
<p>PROCESSING: the processing section iterates through every pixel in every input band, and calculates/writes the strata to the corresponding output band.</p>
<p>There are four different cases dealing with whether or not the entire raster band is allocated in memory (the largeRaster variable is false), and whether or not the values of each band should be mapped to an extra output raster band.</p>
<p>If the raster is large, it is processed in blocks and splits the raster into groups of blocks to be processed by multiple threads. If the raster bands are in-memory, the entire raster is processed at once. The mapped rasters store information on an extra output raster band, the output values of which are determined as a function of all other output raster bands. The multipliers vector stores the information for this.</p>
<p>For the large rasters, the processing starts out by splitting the raster into chunks depending on the number of threads. A thread is then created for each chunk. Within each thread, the blocks within it's designated chunk are iterated through and first read from the input bands, processed, then written to the output bands. In the case of a mapped raster all of the bands are iterated alongside eachother so that the intermediate mapping calculations don't have to be written then read again. In the case of a non mapped raster, each band is processed sequentially.</p>
<p>CLEANUP: If the output dataset is a VRT dataset, the datasets which represent its bands (that have not yet been added as bands) must be added as bands now that they are populated with data and are thus allowed to be added.</p>
<p>If the dataset output bands are fully in memory, they are moved to a vector from their metadata objects to be passed as a parameter to the GDALRasterWrapper constructor (or not if the bands aren't in memory). This GDALRasterWrapper is then returned.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">GDALRasterWrapper</td><td>*p_raster </td></tr>
    <tr><td class="paramname">std::map&lt;int,std::vector&lt;double&gt;&gt;breaks</td><td></td></tr>
    <tr><td class="paramname">bool</td><td>map </td></tr>
    <tr><td class="paramname">std::string</td><td>filename </td></tr>
    <tr><td class="paramname">bool</td><td>largeRaster </td></tr>
    <tr><td class="paramname">int</td><td>threads </td></tr>
    <tr><td class="paramname">std::string</td><td>tempFolder </td></tr>
    <tr><td class="paramname">std::map&lt;std::string,std::string&gt;</td><td>driverOptions </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>GDALRasterWrapper * </dd></dl>

</div>
</div>
<a id="gacbc2118cae477cf128e798fb68aac7e7" name="gacbc2118cae477cf128e798fb68aac7e7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gacbc2118cae477cf128e798fb68aac7e7">&#9670;&#160;</a></span>processMapPixel()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void sgs::breaks::processMapPixel </td>
          <td>(</td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>index</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structsgs_1_1helper_1_1RasterBandMetaData.html">helper::RasterBandMetaData</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>dataBand</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>p_dataBuffer</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structsgs_1_1helper_1_1RasterBandMetaData.html">helper::RasterBandMetaData</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>stratBand</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>p_stratBuffer</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; double &gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>bandBreaks</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>multiplier</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool &amp;</td>          <td class="paramname"><span class="paramname"><em>mapNan</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t &amp;</td>          <td class="paramname"><span class="paramname"><em>mapStrat</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel inline">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>This is a helper function for processing a pixel of data when a mapped stratification is being created.</p>
<p>First, the value is read in as a double, and it is determined whether the pixel is a nan pixel or not. The mapNan boolean is updated in addition to the isNan boolean, to ensure that if one band within the raster is nan at a certain pixel then the mapped raster (but not necessarily all output rasters) is also nan at that pixel.</p>
<p>Then, if it isn't a nan pixel the lower bound of the value within the vector of break values is found. For example, if the value was 3 and the breaks vector was [2, 4, 6], the lower bound would be 1, which is the index of 4, the first value larger than 3 in the breaks vector. This lower bound is the strata. This strata (or the nan value) is then written with the appropriate type to the strat raster band.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">size_t</td><td>index </td></tr>
    <tr><td class="paramname">RasterBandMetaData&amp;</td><td>dataBand </td></tr>
    <tr><td class="paramname">void</td><td>*p_dataBuffer </td></tr>
    <tr><td class="paramname">RasterBandMetaData&amp;</td><td>stratBand </td></tr>
    <tr><td class="paramname">void</td><td>*p_stratBuffer </td></tr>
    <tr><td class="paramname">std::vector&lt;double&gt;&amp;</td><td>bandBreaks </td></tr>
    <tr><td class="paramname">size_t</td><td>multiplier </td></tr>
    <tr><td class="paramname">bool&amp;</td><td>mapNan </td></tr>
    <tr><td class="paramname">size_t&amp;</td><td>mapStrat </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="gab1b387a24b954d815715ecdc3f3b170b" name="gab1b387a24b954d815715ecdc3f3b170b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gab1b387a24b954d815715ecdc3f3b170b">&#9670;&#160;</a></span>processPixel()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void sgs::breaks::processPixel </td>
          <td>(</td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>index</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>p_data</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structsgs_1_1helper_1_1RasterBandMetaData.html">helper::RasterBandMetaData</a> *</td>          <td class="paramname"><span class="paramname"><em>p_dataBand</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>p_strat</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structsgs_1_1helper_1_1RasterBandMetaData.html">helper::RasterBandMetaData</a> *</td>          <td class="paramname"><span class="paramname"><em>p_stratBand</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; double &gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>bandBreaks</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel inline">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>This is a helper function for processing a pixel of data.</p>
<p>First, the value is read in as a double, and it is determined whether the pixel is a nan pixel or not.</p>
<p>Then, if it isn't a nan pixel the lower bound of the value within the vector of break values is found. For example, if the value was 3 and the breaks vector was [2, 4, 6], the lower bound would be 1, which is the index of 4, the first value larger than 3 in the breaks vector. This lower bound is the strata. This strata (or the nan value) is then written with the appropriate type to the strat raster band.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">size_t</td><td>index </td></tr>
    <tr><td class="paramname">void</td><td>*p_data </td></tr>
    <tr><td class="paramname">RasterBandMetaData</td><td>*p_dataBand </td></tr>
    <tr><td class="paramname">void</td><td>*p_strat </td></tr>
    <tr><td class="paramname">RasterBandMetaData</td><td>*p_stratBand </td></tr>
    <tr><td class="paramname">std::vector&lt;double&gt;&amp;</td><td>bandBreaks </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
